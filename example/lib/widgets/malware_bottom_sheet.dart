import 'dart:convert';

import 'package:flutter/material.dart';
import 'package:freerasp/freerasp.dart';

/// Bottom sheet widget that displays malware information
class MalwareBottomSheet extends StatelessWidget {
  /// Represents malware information in the example app
  const MalwareBottomSheet({
    required this.suspiciousApps,
    super.key,
  });

  /// List of suspicious apps
  final List<SuspiciousAppInfo> suspiciousApps;

  @override
  Widget build(BuildContext context) {
    final textTheme = Theme.of(context).textTheme;

    return Container(
      padding: const EdgeInsets.all(16),
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          Text('Suspicious Apps', style: textTheme.titleMedium),
          const SizedBox(height: 8),
          SizedBox(
            height: 240,
            child: ListView.builder(
              itemCount: suspiciousApps.length,
              itemBuilder: (_, index) =>
                  MalwareListTile(malware: suspiciousApps[index]),
            ),
          ),
          const SizedBox(height: 16),
          SizedBox(
            width: double.infinity,
            child: FilledButton(
              onPressed: () => Navigator.pop(context),
              child: const Text('Dismiss'),
            ),
          ),
        ],
      ),
    );
  }
}

/// List tile widget that displays malware information
class MalwareListTile extends StatelessWidget {
  /// Represents malware information in the example app
  const MalwareListTile({
    required this.malware,
    super.key,
  });

  /// Malware information
  final SuspiciousAppInfo malware;

  @override
  Widget build(BuildContext context) {
    return ListTile(
      title: Text(malware.packageInfo.packageName),
      subtitle: Text('Reason: ${malware.reason}'),
      leading: malware.packageInfo.appIcon == null
          ? const Icon(Icons.warning, color: Colors.red)
          : Image.memory(base64.decode(malware.packageInfo.appIcon!)),
    );
  }
}
